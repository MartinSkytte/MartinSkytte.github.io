<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Assignment 2</title>
        <script type="text/javascript" src="js/d3.min.js"></script>
        <style type="text/css">
            html, body {
                font-family: Helvetica, Arial, Verdana, sans-serif;
                font-weight: bold;
            }

            body {
                font-size: 14px;
                line-height: 1.42857143;
                color: #333;
                background-color: #fff;
            }

            html {
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            }

            svg {
                font: 10px sans-serif;
            }

            text {
                font: 10px sans-serif;
            }

            .axis path {
                fill: none;
                stroke: none;
            }

            .axis line {
                fill: none;
                stroke: black;
                shape-rendering: crispEdges;
            }

            .axis text {
                font-family: sans-serif;
                font-size: 11px;
            }
            /*
                        .svg-container {
                            display: inline-block;
                            position: relative;
                            vertical-align: middle;
                            overflow: hidden;
                        }
            */
            .tooltip {
                position: absolute;
                width: 250px;
                height: auto;
                padding: 10px;
                color: #fff;
                background: #000;
                z-index: 80;
            }

            .tooltip.hidden {
                display: none;
            }

            .tooltip p {
                margin: 0;
                font-family: sans-serif;
                font-size: 16px;
                line-height: 20px;
            }

            #tooltip-vis-one #district {
                margin: 0;
                padding: 0;
            }

            /* make grid system */
            .container {
                width: 1300px;
                padding-right: 15px;
                padding-left: 15px;
                margin-right: auto;
                margin-left: auto;
            }

            .row {
                margin-right: -15px;
                margin-left: -15px;
            }

            .container:before,
            .container:after,
            .row:before,
            .row:after {
                display: table;
                content: " ";
            }

            .row:after {
                clear: both;
            }

            .col-left {
                padding-left: 10px;
                padding-right: 10px;
                float: left;
                width: 300px;
            }

            .col-right {
                padding-left: 10px;
                padding-right: 10px;
                padding-top: 30px;
                float: left;
                width: 990px;
            }

            .btn {
                background-color: #337ab7;
                border-color: #2e6da4;
                color: #fff;
                display: inline-block;
                padding: 6px 12px;
                margin-bottom: 0;
                font-size: 14px;
                font-weight: normal;
                line-height: 1.42857143;
                text-align: center;
                white-space: nowrap;
                vertical-align: middle;
                -ms-touch-action: manipulation;
                touch-action: manipulation;
                cursor: pointer;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                background-image: none;
                border: 1px solid transparent;
                border-radius: 4px;
            }
            .btn:focus,
            .btn:active:focus,
            .btn.active:focus,
            .btn.focus,
            .btn:active.focus,
            .btn.active.focus {
                outline: thin dotted;
                outline: 5px auto -webkit-focus-ring-color;
                outline-offset: -2px;
            }
            .btn:hover,
            .btn:focus,
            .btn.focus {
                background-color: #286090;
                border-color: #122b40;
                text-decoration: none;
            }
            .btn:active,
            .btn.active {
                background-color: #286090;
                border-color: #204d74;
                background-image: none;
                outline: 0;
                -webkit-box-shadow: inset 0 3px 5px rgba(0, 0, 0, .125);
                box-shadow: inset 0 3px 5px rgba(0, 0, 0, .125);
            }

            .pull-left {
                float:left;
            }

            .pull-right {
                float:right;
            }

            .margin-5 {
                margin: 5px;
            }

            .center-text {
                text-align: center;
            }

            .left-text {
                text-align: left;
            }

            .margin-top50 {
                margin-top: 50px;
            }
        </style>
    </head>
    <body>
        <div class="container center-text">
            <h1>Assignment 2</h1>
        </div>
        <div class="container center-text">
            <h2>Assignment 2A: Simple SVG Stuff</h2>
            <p>Here we see some simple exercises, where a svg image is made. Afterwards a simple javascript using the D3 liberary is doing some of the 5 table</p>
            <div  class="left-text">
                <svg width="500" height="100">
                <rect x="0" y="20" width="80" height="80" fill="purple" stroke="gray" stroke-width="2" fill-opacity="0.9"/>
                <rect x="20" y="15" width="80" height="80" fill="blue" stroke="gray" stroke-width="2" fill-opacity="0.8"/>
                <rect x="40" y="10" width="80" height="80" fill="green" stroke="gray" stroke-width="2" fill-opacity="0.6"/>
                <rect x="60" y="5" width="80" height="80" fill="yellow" stroke="gray" stroke-width="2" fill-opacity="0.4"/>
                <rect x="80" y="0" width="80" height="80" fill="red" stroke="gray" stroke-width="2" fill-opacity="0.2"/>
                </svg>
                <div id="counter">

                </div>
            </div>
        </div>

        <div class="container margin-top50 center-text">
            <h2>Assignment 2B: One scatter plot two datasets</h2>
            <div class="row">
                <div class="col-left left-text">
                    <p>The graph on the right shows the prostitution and the vehicle theft by
                        district in San Francisco.</p>
                    <p>By clicking on the buttons below you can choose, to see how the crime
                        changes between the years. For further information click on the 
                        circles in the diagram</p>
                    <p>The reason the axis stays the same is so you get a picture of the change 
                        over time, and can see how much the different districts have moved. 
                        This also gives a better understanding of how much the crimes have 
                        changed over time.</p>
                    <a class="btn" onclick="switchPVYear(2003)">2003</a>
                    <a class="btn" onclick="switchPVYear(2015)">2015</a>
                </div>
                <div class="col-right">
                    <div id="visualization-one" class="svg-container">

                    </div>
                    <div id="tooltip-vis-one" class="tooltip hidden">
                        <h3 id="district"></h3>
                        <p><span id="value"></span></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="container margin-top50 center-text">
            <h2>Assignment 2C: One barchart and (at least) two datasets</h2>
            <div class="row">
                <div class="col-left">
                    <p>Here you can see how many crimes that where committed by 
                        the type of crime, it is indexed by the year from 2003 to
                        2014.</p>
                    <p>Click on the buttons below the graph to see the crimes
                        for other types of crimes</p>
                </div>
                <div class="col-right">
                    <div id="visualization-two">

                    </div>
                    <a id="pre-crime" class="btn pull-left"></a>
                    <a id="nxt-crime" class="btn pull-right"></a>
                </div>
            </div>
        </div>

        <div class="container margin-top50 center-text">
            <h2>Assignment 2D: Visualizing geodata</h2>
            <p>Here is a scatter plot showing the k mean, of the prostitution in San Francisco.
                If you click on a button it will activate a new layout with another k mean. When 
                hovering over a button it shows a preview of the data directly on the map.
            </p>
            <p>Answering side questions, the reason for making file sizes as small as possible,
                is that a user of the website has to download the data, and the website will be
                slow if the files are to big.
            </p>
            <p>
                See the full assignment of the k mean <a href="https://www.dropbox.com/s/0mxbbl6ntca1otm/Week%205%20K-Means.ipynb?dl=0">here</a>
            </p>
            <div id="buttons" class="center-text margin-5">

            </div>
            <div id="map-vis">

            </div>
        </div>

        <script type="text/javascript">

            var dataset = [5, 10, 15, 20, 25];

            d3.select("#counter").selectAll("p")
                    .data(dataset)
                    .enter()
                    .append("p")
                    .text(function (d) {
                        return "I can count up to " + d;
                    })
                    .style("color", function (d) {
                        if (d > 15) {	//Threshold of 15
                            return "red";
                        } else {
                            return "black";
                        }
                    });

        </script>
        <script type="text/javascript">
            // data sets
            var prostitutionVehicleData2003 = [];
            var prostitutionVehicleData2015 = [];
            var crimesData = {};

            // sizes
            var padding = 50;
            var h = 500;
            var w = 1000;

            // scales
            var scaleVisOneX;
            var scaleVisOneY;
            var scaleVisOneColor;

            // misc
            var lastTooltipVisOne = "";
            var crimesKeys;
            var crimeIndex;

            d3.csv("prostitution_vehicle.csv", function (data) {
                generatePVPlotData(data);
                generateScaling();
                generatePVPlotFromYear();
            });

            d3.csv("crime_per_year.csv", function (data) {
                generateCrimeData(data);
                setupLinke();
                generateCrime();
            });

            function setupLinke() {
                var previous = d3.select("#pre-crime");
                var next = d3.select("#nxt-crime");

                previous.attr("data-target", crimesKeys.length - 1)
                        .html("&laquo; " + crimesKeys[crimesKeys.length - 1]);

                next.attr("data-target", 1)
                        .html(crimesKeys[1] + " &raquo;");

                previous.on("click", function () {
                    var target = +d3.select(d3.event.target).attr("data-target")
                    calculateNewLinks(target);
                    updateCrime(target);
                });

                next.on("click", function () {
                    var target = +d3.select(d3.event.target).attr("data-target")
                    calculateNewLinks(target);
                    updateCrime(target);
                });
            }

            function calculateNewLinks(target) {
                var next;
                var previous;

                if (target === 0) {
                    previous = crimesKeys.length - 1;
                    next = target + 1;
                } else if (target === crimesKeys.length - 1) {
                    previous = target - 1;
                    next = 0;
                } else {
                    previous = target - 1;
                    next = target + 1;
                }

                previous = (previous === -1) ? crimesKeys.length - 1 : previous;
                next = (next === crimesKeys.length - 1) ? 0 : next;

                d3.select("#pre-crime")
                        .attr("data-target", previous)
                        .html("&laquo; " + crimesKeys[previous]);

                d3.select("#nxt-crime")
                        .attr("data-target", next)
                        .html(crimesKeys[next] + " &raquo;");
            }

            function updateCrime(target) {
                var dataset = crimesData[crimesKeys[target]];

                var scaleX = d3.scale.ordinal()
                        .domain(dataset.map(function (d) {
                            return d[0];
                        }))
                        .rangeRoundBands([padding, w - padding * 2], .1);

                var scaleY = d3.scale.linear()
                        .domain([0, d3.max(dataset, function (d) {
                                return d[1];
                            })])
                        .range([h - padding, padding * 2]);

                var scaleColor = d3.scale.linear()
                        .domain([d3.min(dataset, function (d) {
                                return d[1];
                            }), d3.max(dataset, function (d) {
                                return d[1];
                            })])
                        .range([20, 255]);

                var svg = d3.select("#vis-two");

                svg.selectAll(".bar")
                        .data(dataset)
                        .transition()
                        .duration(1000)
                        .attr("x", function (d) {
                            return scaleX(d[0]);
                        })
                        .attr("width", scaleX.rangeBand())
                        .attr("y", function (d) {
                            return scaleY(d[1]);
                        })
                        .attr("height", function (d) {
                            return h - scaleY(d[1]) - padding;
                        })
                        .attr("fill", function (d) {
                            var val = Math.round(scaleColor(d[1]));
                            return "rgb(0, " + val + ", " + val + ")";
                        });

                svg.select("#title")
                        .transition()
                        .duration(1000)
                        .text(crimesKeys[target]);

                svg.selectAll(".y.axis")
                        .transition()
                        .duration(1000)
                        .call(d3.svg.axis()
                                .scale(scaleY)
                                .orient("left"));

                svg.transition()
                        .duration(1000)
                        .selectAll(".x.axis")
                        .call(d3.svg.axis()
                                .scale(scaleX)
                                .orient("bottom"));


                var yTextPadding = 20;
                svg.selectAll(".bartext")
                        .data(dataset)
                        .attr("x", function (d) {
                            return scaleX(d[0]) + scaleX.rangeBand() / 2;
                        })
                        .attr("y", function (d) {
                            return h - padding - yTextPadding;
                        })
                        .text(function (d) {
                            return d[1];
                        });

            }

            /**
             * Setup the general datastructure for
             * the graphs
             * 
             * @param data fom csv file
             */
            function generateCrimeData(data) {
                for (var i = 0; i < data.length; i++) {
                    if (crimesData[data[i]['crime']]) {
                        crimesData[data[i]['crime']].push([data[i]['year'], data[i]['count']]);
                    } else {
                        crimesData[data[i]['crime']] = [[data[i]['year'], data[i]['count']]];
                    }
                }

                crimesKeys = Object.keys(crimesData).sort();
            }

            /**
             * Generate a new svg image with a graph
             */
            function generateCrime() {

                var dataset = crimesData[crimesKeys[0]];

                var scaleX = d3.scale.ordinal()
                        .domain(dataset.map(function (d) {
                            return d[0];
                        }))
                        .rangeRoundBands([padding, w - padding * 2], .1);

                var scaleY = d3.scale.linear()
                        .domain([0, d3.max(dataset, function (d) {
                                return d[1];
                            })])
                        .range([h - padding, padding]);

                // set up image and prep it for responsiveness
                var svg = d3.select("#visualization-two")
                        .append("svg")
                        .attr("id", "vis-two")
                        .attr("viewBox", "0 0 " + w + " " + h)
                        .attr("perserveAspectRatio", "xMinYMid");

                // set title
                svg.append("text")
                        .attr("id", "title")
                        .attr("x", (w / 2))
                        .attr("y", 35)
                        .attr("text-anchor", "middle")
                        .style("font-size", "30px")
                        .text(crimesKeys[0]);

                // setup x label
                svg.append("text")
                        .attr("class", "x label")
                        .attr("text-anchor", "end")
                        .attr("x", w)
                        .attr("y", h - 6)
                        .text("Year");

                // setup y label
                svg.append("text")
                        .attr("class", "y label")
                        .attr("text-anchor", "end")
                        .attr("y", 6)
                        .attr("dy", ".75em")
                        .attr("transform", "rotate(-90)")
                        .text("Crime Count");

                // setup x axis
                svg.append("g")
                        .attr("class", "x axis")
                        .attr("transform", "translate(0," + (h - padding) + ")")
                        .call(d3.svg.axis()
                                .scale(scaleX)
                                .orient("bottom"));

                // setup y axis
                svg.append("g")
                        .attr("class", "y axis")
                        .attr("transform", "translate(" + padding + ",0)")
                        .call(d3.svg.axis()
                                .scale(scaleY)
                                .orient("left"));

                createCrime(dataset);
            }

            function createCrime(dataset) {
                var scaleX = d3.scale.ordinal()
                        .domain(dataset.map(function (d) {
                            return d[0];
                        }))
                        .rangeRoundBands([padding, w - padding * 2], .1);

                var scaleY = d3.scale.linear()
                        .domain([0, d3.max(dataset, function (d) {
                                return d[1];
                            })])
                        .range([h - padding, padding * 2]);

                var scaleColor = d3.scale.linear()
                        .domain([d3.min(dataset, function (d) {
                                return d[1];
                            }), d3.max(dataset, function (d) {
                                return d[1];
                            })])
                        .range([20, 255]);

                var svg = d3.select("#vis-two");

                svg.selectAll(".bar")
                        .data(dataset)
                        .enter()
                        .append("rect")
                        .attr("class", "bar")
                        .attr("x", function (d) {
                            return scaleX(d[0]);
                        })
                        .attr("width", scaleX.rangeBand())
                        .attr("y", function (d) {
                            return scaleY(d[1]);
                        })
                        .attr("height", function (d) {
                            return h - scaleY(d[1]) - padding;
                        })
                        .attr("fill", function (d) {
                            var val = Math.round(scaleColor(d[1]));
                            return "rgb(0, " + val + ", " + val + ")";
                        });

                var yTextPadding = 20;
                svg.selectAll(".bartext")
                        .data(dataset)
                        .enter()
                        .append("text")
                        .attr("class", "bartext")
                        .attr("text-anchor", "middle")
                        .attr("fill", "white")
                        .attr("x", function (d) {
                            return scaleX(d[0]) + scaleX.rangeBand() / 2;
                        })
                        .attr("y", function (d) {
                            return h - padding - yTextPadding;
                        })
                        .text(function (d) {
                            return d[1];
                        });
            }

            /**
             * Setup the scaling elements for the first graph
             */
            function generateScaling() {

                var datasetScaling = [];
                var tempSet = prostitutionVehicleData2003.concat(prostitutionVehicleData2015);

                for (var i = 0; i < tempSet.length; i++) {
                    datasetScaling.push([tempSet[i]['PROSTITUTION'], tempSet[i]['VEHICLE THEFT']]);
                }

                scaleVisOneX = d3.scale.linear()
                        .domain([0, d3.max(datasetScaling, function (d) {
                                return d[0];
                            })])
                        .range([padding, w - padding * 2]);

                scaleVisOneY = d3.scale.linear()
                        .domain([0, d3.max(datasetScaling, function (d) {
                                return d[1];
                            })])
                        .range([h - padding, padding]);

                scaleVisOneColor = d3.scale.linear()
                        .domain([d3.min(datasetScaling, function (d) {
                                return (d[0] + d[1]);
                            }), d3.max(datasetScaling, function (d) {
                                return (d[0] + d[1]);
                            })])
                        .range([20, 255]);
            }

            /**
             * Generate the plot data into one of two global
             * arrays
             * 
             * @param array data
             */
            function generatePVPlotData(data) {
                for (i = 0; i < data.length; i++) {
                    // it the year is 2003
                    if (+data[i]['year'] === +2003) {
                        index = listObjectContainsDistrict(prostitutionVehicleData2003, data[i]['district']);

                        // if index is not null
                        if (index !== null) {
                            var tmp = prostitutionVehicleData2003[index];
                            tmp[data[i]['crime']] = +data[i]['amount'];
                            prostitutionVehicleData2003[index] = tmp;
                        } else {
                            var obj = {'district': data[i]['district']};
                            obj[data[i]['crime']] = +data[i]['amount'];
                            obj['total'] = data[i]['total'];
                            prostitutionVehicleData2003.push(obj);
                        }
                    } else {
                        index = listObjectContainsDistrict(prostitutionVehicleData2015, data[i]['district']);

                        // if index is not null
                        if (index !== null) {
                            var tmp = prostitutionVehicleData2015[index];
                            tmp[data[i]['crime']] = +data[i]['amount'];
                            prostitutionVehicleData2015[index] = tmp;
                        } else {
                            var obj = {'district': data[i]['district']};
                            obj[data[i]['crime']] = +data[i]['amount'];
                            obj['total'] = data[i]['total'];
                            prostitutionVehicleData2015.push(obj);
                        }
                    }
                }
            }

            /**
             * Check if given list contains an object with
             * a specific district
             * 
             * @param array list the list we are checking in
             * @param string value district we are looking for
             * @returns null|int null if list does not contain value
             */
            function listObjectContainsDistrict(list, value) {
                var index = null;
                for (var i = 0; i < list.length; i++) {
                    if (list[i]['district'] === value) {
                        index = i;
                        break;
                    }
                }

                return index;
            }

            /**
             * Generate a new svg image with a graph
             */
            function generatePVPlotFromYear() {

                var dataset = prostitutionVehicleData2003;

                // set up image and prep it for responsiveness
                var svg = d3.select("#visualization-one")
                        .append("svg")
                        .attr("id", "vis-one")
                        .attr("viewBox", "0 0 " + w + " " + h)
                        .attr("perserveAspectRatio", "xMinYMid");

                svg.on("click", function () {
                    d3.select("#tooltip-vis-one").classed("hidden", true);
                });

                // set title
                svg.append("text")
                        .attr("id", "title")
                        .attr("x", (w / 2))
                        .attr("y", 35)
                        .attr("text-anchor", "middle")
                        .style("font-size", "30px")
                        .text("Crime for Year 2003");

                // setup x label
                svg.append("text")
                        .attr("class", "x label")
                        .attr("text-anchor", "end")
                        .attr("x", w)
                        .attr("y", h - 6)
                        .text("PROSTITUTION");

                // setup y label
                svg.append("text")
                        .attr("class", "y label")
                        .attr("text-anchor", "end")
                        .attr("y", 6)
                        .attr("dy", ".75em")
                        .attr("transform", "rotate(-90)")
                        .text("VEHICLE THEFT");

                // setup x axis
                svg.append("g")
                        .attr("class", "axis")
                        .attr("transform", "translate(0," + (h - padding) + ")")
                        .call(d3.svg.axis()
                                .scale(scaleVisOneX)
                                .orient("bottom"));

                // setup y axis
                svg.append("g")
                        .attr("class", "axis")
                        .attr("transform", "translate(" + padding + ",0)")
                        .call(d3.svg.axis()
                                .scale(scaleVisOneY)
                                .orient("left"));

                createPV(dataset);
            }

            /**
             * Update the current graph with the new data
             * 
             * @param array dataset the dataset
             */
            function updatePV(dataset) {
                d3.select("#tooltip-vis-one").classed("hidden", true);
                var svg = d3.select("#vis-one");

                var districts = svg.selectAll("g.node")
                        .data(dataset, function (d) {
                            return d.district;
                        });

                var district = districts
                        .transition()
                        .duration(1000)
                        .attr('transform', function (d) {
                            return "translate(" + scaleVisOneX(d['PROSTITUTION']) + "," + scaleVisOneY(d['VEHICLE THEFT']) + ")";
                        });

                district.select("circle")
                        .attr("r", function (d) {
                            var val = d['PROSTITUTION'] + d['VEHICLE THEFT'];
                            return (val / d['total']) * 100;
                        })
                        .attr("fill", function (d) {
                            var val = Math.round(scaleVisOneColor(d['PROSTITUTION'] + d['VEHICLE THEFT']));
                            return "rgb(0, " + val + ", " + val + ")";
                        });

                district.select("text")
                        .text(function (d) {
                            return d['district'];
                        });
            }

            /**
             * Create the scatter plot elements in the
             * graph and setup event listeners
             * 
             * @param array dataset the data
             */
            function createPV(dataset) {

                var svg = d3.select("#vis-one");

                var districts = svg.selectAll("g.node")
                        .data(dataset, function (d) {
                            return d.district;
                        });

                var district = districts.enter()
                        .append("g")
                        .attr("class", "node")
                        .attr('transform', function (d) {
                            return "translate(" + scaleVisOneX(d['PROSTITUTION']) + "," + scaleVisOneY(d['VEHICLE THEFT']) + ")";
                        });

                district.append("circle")
                        .attr("r", function (d) {
                            var val = d['PROSTITUTION'] + d['VEHICLE THEFT'];
                            return (val / d['total']) * 100;
                        })
                        .attr("fill", function (d) {
                            var val = Math.round(scaleVisOneColor(d['PROSTITUTION'] + d['VEHICLE THEFT']));
                            return "rgb(0, " + val + ", " + val + ")";
                        })
                        .on('click', function (d) {

                            // Update the tooltip position and value
                            d3.select("#tooltip-vis-one")
                                    .style("left", (d3.event.pageX + 5) + "px")
                                    .style("top", (d3.event.pageY - 28) + "px")
                                    .select("#value")
                                    .html(
                                            "Prostitution: " + d['PROSTITUTION'] + "<br/>" +
                                            "Vehicle Theft: " + d['VEHICLE THEFT'] + "<br/>" +
                                            "Total Crimes in District: " + d['total'] + "<br/>" +
                                            "Which corresponds to " + (((d['PROSTITUTION'] + d['VEHICLE THEFT']) / d['total']) * 100).toFixed(2) + "% of crime in the district, " +
                                            "is either prostitution or vehicle theft in the choosen year"
                                            );
                            d3.select("#tooltip-vis-one")
                                    .select("#district")
                                    .html("Crimes in " + d['district'].toLowerCase());

                            // hide show tooltip
                            if (d3.select("#tooltip-vis-one").classed("hidden") || lastTooltipVisOne !== d['district']) {
                                d3.select("#tooltip-vis-one").classed("hidden", false);
                            } else {
                                d3.select("#tooltip-vis-one").classed("hidden", true);
                            }

                            lastTooltipVisOne = d['district'];
                            d3.event.stopPropagation();
                        });

                district.append("text")
                        .style("text-anchor", "middle")
                        .attr("dy", function (d) {
                            val = ((d['PROSTITUTION'] + d['VEHICLE THEFT']) / d['total']) * 100;
                            return (val * -1);
                        })
                        .text(function (d) {
                            return d['district'];
                        });

                district.style("opacity", 0)
                        .transition()
                        .duration(1000)
                        .style("opacity", 1);
            }

            /**
             * Given a year 2013 or 2015 it 
             * will update the graph with the
             * dataset for the given year
             * 
             * @param int year
             */
            function switchPVYear(year) {
                var dataset = prostitutionVehicleData2003;

                if (+year === 2015) {
                    dataset = prostitutionVehicleData2015;
                }

                d3.select("#vis-one")
                        .select("#title")
                        .transition()
                        .duration(500)
                        .style("opacity", 0)
                        .transition()
                        .duration(500)
                        .text("Crime for year " + year)
                        .style("opacity", 1);

                updatePV(dataset);
            }
        </script>
        <script type="text/javascript">
            var width = 920;
            var height = 800;
            var centers = [];
            var projection;
            var dataContainer = [];
            var centerContainer = {};
            var current;

            //Define map projection
            projection = d3.geo.mercator()
                    .scale(250000)
                    .center([-122.433701, 37.767683])
                    .translate([width / 2, height / 2]);

            //Define path generator
            var path = d3.geo.path()
                    .projection(projection);

            //Create SVG element
            var svgmap = d3.select("#map-vis")
                    .append("svg")
                    .attr("id", "sfmap")
                    .attr("width", width)
                    .attr("height", height);

            var countourG = svgmap.append("g");

            //Load in GeoJSON data
            d3.json("sfpddistricts.json", function (json) {

                //Bind data and create one path per GeoJSON feature
                countourG.selectAll("path")
                        .data(json.features)
                        .enter()
                        .append("path")
                        .attr("d", path)
                        .attr("stroke", "black")
                        .style("fill", "steelblue");
            });

            // setup the center markers
            function setupCenter(data) {
                var numberOfCenters = data[0].Cluster;
                for (var i = 0; i < data.length; i++) {
                    if (!centers[data[i].Label]) {
                        centers[data[i].Label] = {"Label": data[i].Label, "X": data[i].X, "Y": data[i].Y};
                        if (numberOfCenters + 1 === Object.keys(centers).length) {
                            break;
                        }
                    }
                }
            }

            // setup buttons and events
            function setupButtons(keys) {

                keys.forEach(function (d) {
                    d3.select("#buttons")
                            .data(d)
                            .append("a")
                            .attr("class", "btn margin-5")
                            .html(function (d) {
                                return "Show for k" + d;
                            })
                            .on("click", function (d) {
                                current = d;
                                createPoints(d);
                            })
                            .on("mouseover", function (d) {
                                createPoints(d);
                            })
                            .on("mouseout", function () {
                                createPoints(current);
                            });
                });
            }

            // create, update and delete points
            function createPoints(data) {
                // create map
                var svg = d3.select("#sfmap");

                // prepare title
                var text = svg.selectAll("text")
                        .data(dataContainer, function (d) {
                            return d;
                        });

                // update title
                text.text("Showing for k" + data);

                // add title
                text.enter().append("text")
                        .attr("id", "title")
                        .attr("x", (width / 2))
                        .attr("y", 35)
                        .attr("text-anchor", "middle")
                        .style("font-size", "30px")
                        .text("Showing for k" + data);

                // remove title
                text.exit().remove();

                // select and update points
                var points = svg.selectAll(".point")
                        .data(dataContainer)
                        .attr("cx", function (d) {
                            return projection([+d.X, +d.Y])[0];
                        })
                        .attr("cy", function (d) {
                            return projection([+d.X, +d.Y])[1];
                        })
                        .style("fill", function (d) {
                            var label = d.Labels[data];
                            if (+label === 0)
                                return "yellow";
                            if (+label === 1)
                                return "red";
                            if (+label === 2)
                                return "green";
                            if (+label === 3)
                                return "purple";
                            if (+label === 4)
                                return "hotpink";
                            if (+label === 5)
                                return "saddlebrown";
                        });

                // select and update center points
                var centerPoints = svg.selectAll(".centers")
                        .data(centerContainer[data])
                        .attr("cx", function (d) {
                            return projection([+d.X, +d.Y])[0];
                        })
                        .attr("cy", function (d) {
                            return projection([+d.X, +d.Y])[1];
                        })
                        .style("fill", function (d) {
                            if (+d.Label === 0)
                                return "yellow";
                            if (+d.Label === 1)
                                return "red";
                            if (+d.Label === 2)
                                return "green";
                            if (+d.Label === 3)
                                return "purple";
                            if (+d.Label === 4)
                                return "hotpink";
                            if (+d.Label === 5)
                                return "saddlebrown";
                        });

                // add points
                points.enter()
                        .append("circle")
                        .attr("class", "point")
                        .attr("cx", function (d) {
                            return projection([+d.X, +d.Y])[0];
                        })
                        .attr("cy", function (d) {
                            return projection([+d.X, +d.Y])[1];
                        })
                        .attr("r", 5)
                        .style("fill", function (d) {
                            var label = d.Labels[data];
                            if (+label === 0)
                                return "yellow";
                            if (+label === 1)
                                return "red";
                            if (+label === 2)
                                return "green";
                            if (+label === 3)
                                return "purple";
                            if (+label === 4)
                                return "hotpink";
                            if (+label === 5)
                                return "saddlebrown";
                        });

                // update points style
                points.style("opacity", 0.75);

                // delete points
                points.exit().remove();

                // add center points
                centerPoints.enter()
                        .append("circle")
                        .attr("class", "centers")
                        .attr("cx", function (d) {
                            return projection([+d.X, +d.Y])[0];
                        })
                        .attr("cy", function (d) {

                            return projection([+d.X, +d.Y])[1];
                        })
                        .attr("r", 15)
                        .style("fill", function (d) {
                            if (+d.Label === 0)
                                return "yellow";
                            if (+d.Label === 1)
                                return "red";
                            if (+d.Label === 2)
                                return "green";
                            if (+d.Label === 3)
                                return "purple";
                            if (+d.Label === 4)
                                return "hotpink";
                            if (+d.Label === 5)
                                return "saddlebrown";
                        });

                // update style on center points
                centerPoints.style("stroke", "Black")
                        .style("stroke-width", 2)
                        .style("opacity", 0.75);

                // remove center points
                centerPoints.exit().remove();
            }

            // check for specific label in list
            function containsLabel(list, label) {
                for (var i = 0; i < list.length; i++) {
                    if ("" + list[i]['Label'] === "" + label) {
                        return true;
                    }
                }

                return false;
            }

            // setup the data structure
            function generateData(data) {
                var center = "";
                for (var i = 0; i < data.length; i++) {
                    var tmp = {"X": data[i]['X'], "Y": data[i]['Y']};
                    var labels = JSON.parse(data[i]['Labels']);
                    tmp['Labels'] = labels;
                    dataContainer.push(tmp);

                    if (center === "") {
                        center = JSON.parse(data[i]['Centers']);
                    }
                }

                var containerKeys = Object.keys(center);
                for (var i = 0; i < containerKeys.length; i++) {
                    keys = Object.keys(center[containerKeys[i]]);
                    for (var j = 0; j < keys.length; j++) {

                        if (centerContainer[containerKeys[i]]) {
                            if (!containsLabel(centerContainer[containerKeys[i]], keys[j])) {
                                centerContainer[containerKeys[i]].push({"Label": keys[j], "X": center[containerKeys[i]][keys[j]].X, "Y": center[containerKeys[i]][keys[j]].Y});
                            }
                        } else {
                            centerContainer[containerKeys[i]] = [{"Label": keys[j], "X": center[containerKeys[i]][keys[j]].X, "Y": center[containerKeys[i]][keys[j]].Y}];
                        }
                    }
                }
                setupButtons(Object.keys(centerContainer).sort());
            }

            d3.csv("Kmeans.csv", function (data) {
                generateData(data);
                current = Object.keys(centerContainer).sort()[0];
                createPoints(current);
            });

        </script>
    </body>
</html>